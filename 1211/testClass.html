<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>吃吃看</title>
    <style>
        table {
            font-family: arial, sans-serif;
            border-collapse: collapse;
            width: 100%;
        }

        td,
        th {
            border: 1px solid lightgrey;
            padding: 8px;
            text-align: center;
        }

        .text-red {
            color: red;
            font-size: 25px;
        }
    </style>


</head>

<body>
    <h2>Taster</h2>

    <table>
        <tr>
            <th width="15%">pic</th>
            <th width="20%">desc</th>
            <th width="10%">數量</th>
            <th>小計</th>

        </tr>

        <tr>
            <td>
                <img src="./1.jpg" width="180px" height="160px">
            </td>
            <td>
                <p>巧克力泡芙</p>
                <p class="priceClass" id="price1" data-price="50">
                    50元
                </p>
                <p>
                    內容物:巧克力鮮奶油、植物奶油、雞蛋、麵粉、巧克力醬

                </p>
            </td>

            <td>
                <input class="inputClass" type="number" name="" id="input1" max="10" min="0">
            </td>

            <td>
                <p id="total1">
                    0
                </p>
            </td>
        </tr>
        <tr>
            <td>
                <img src="./3.jpg" width="180px" height="160px">
            </td>
            <td>
                <p>牛肉咖哩餃</p>
                <p class="priceClass" id="price2" data-price="75">
                    75元
                </p>
                <p>
                    成份: 咖哩粉、澳洲牛肉、洋蔥、植物奶油、麵粉

                </p>
            </td>

            <td>
                <input class="inputClass" type="number" name="" id="input2" max="10" min="0">
            </td>

            <td>
                <p class="totalClass" id="total2">
                    0
                </p>
            </td>
        </tr>
        <tr>
            <td>
                <img src="./2.jpg" width="180px" height="160px">
            </td>
            <td>
                <p>巧克力布朗尼</p>
                <p class="priceClass" id="price3" data-price="55">
                    55元
                </p>
                <p>
                    內容物:巧克力蛋糕體加入杏仁核桃
                </p>
            </td>

            <td>
                <input class="inputClass" type="number" name="" id="input3" max="10" min="0">
            </td>

            <td>
                <p class="totalClass" id="total3">
                    0
                </p>
            </td>
        </tr>

        <tr>
            <td colspan="3">
                總共金額為
            </td>
            <!-- <td>
            </td>
            <td>
            </td> -->
            <td>
                <p id="sumResult">
                    0 元
                </p>

            </td>
        </tr>


    </table>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        $(document).ready(function () {

            function getSum() {
                let sum = 0;
                totalClass.each(function (index, element) {
                    console.log('index', index);
                    console.log('element', element);
                    console.log('this', this);

                    let getTotalValue = Number($(this).text());
                    sum = sum + getTotalValue;

                })



                //重構
                if (sum >= 200) {
                    sum = sum * 0.8;
                    sumResult.attr('class', 'text-red');
                } else {
                    sumResult.attr('class', '');
                }

                let resultString = `${sum}元`;
                sumResult.text(resultString);

            }

            //1.bind

            const price1 = $('#price1');
            const input1 = $('#input1');
            const total1 = $('#total1');

            const priceClass = $('.priceClass');
            const inputClass = $('.inputClass');
            const totalClass = $('.totalClass');

            console.log('priceClass', priceClass);
            console.log('inputClass', inputClass);
            console.log('totalClass', totalClass);

            const sumResult = $('#sumResult');
            let sum = 0;

            //2.action
            $.each(inputClass, function (indexInArray, valueofElement) {
                $(this).change(function (e) {
                    console.log('change ok');

                    console.log('now $(this)', $(this));

                    myParent = $(this).parent().parent();
                    console.log('myParent', myParent);

                    myPrice = myParent.find('.priceClass').attr('data-price');
                    console.log('myPrice', myPrice);

                    myTotal = myParent.find('.totalClass');



                    let getPriceValue = Number(myPrice);
                    let getInputValue = Number($(this).val());
                    let result = getPriceValue * getInputValue;
                    console.log(getPriceValue);
                    console.log(getInputValue);
                    console.log(result);

                    myTotal.text(result);
                    getSum();
                })

            })



        });

    </script>

</body>